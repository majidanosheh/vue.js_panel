# ğŸ“„ PROJECT: AnosheCMS - Master Context
# ğŸ‘¤ Lead Developer: Majid
# ğŸ¤– AI Role: Senior Full-Stack Architect & Code Reviewer
# ğŸ¯ Core Goal: Enterprise-grade Headless CMS (High maintainability, Scalability, Performance)
# ğŸ“… Last Update: 2025-12-06 (Phase 4 Completed, Phase 5 Started)

## 1. ğŸ—ï¸ Architecture & Patterns (The Rules)
- **Style:** Clean Architecture (Onion Architecture).
  - **Domain:** Pure entities, Enums, Constants (No external dependencies).
  - **Application:** Interfaces, DTOs, Services (Depends on Domain).
  - **Infrastructure:** DbContext, Migrations, FileSystem, Email (Depends on Application).
  - **API:** Controllers, Middleware, Entry Point (Depends on Application & Infra).
- **Design Patterns:**
  - **Result Pattern:** Use wrapper objects (Success/Fail) instead of Exceptions for logic flow.
  - **Dependency Injection (DI):** Strict usage for all services.

## 2. ğŸ› ï¸ Technology Stack
- **Backend:** ASP.NET Core 8 (Web API)
  - **ORM:** Entity Framework Core (SQL Server)
  - **Validation:** FluentValidation (Server-side)
  - **Mapping:** Manual Mapping
- **Frontend:** Vue.js 3 (Composition API, <script setup>)
  - **State:** Pinia (Setup Stores)
  - **HTTP:** Axios (w/ Robust Interceptors)
  - **UI:** Custom CSS + VueDraggable (FormBuilder) + Sticky Table Headers

## 3. âœ… Current Implementation Status (What is DONE)

### A. Authentication & Security ğŸ›¡ï¸
- JWT Auth (Access + Refresh Token), RBAC (Dynamic Permissions), Rescue Admin.

### B. User Management ğŸ‘¥
- Full CRUD, Role Management with Permission Matrix.

### C. Form Builder Module ğŸ“
- **Backend:** `Form`, `FormField`, `FormSubmission` entities. Dynamic validation.
- **Frontend:** Drag & Drop Designer, Public Renderer, Submissions Grid (CSV Export).

### D. Audit Logging & Monitoring (Phase 4) ğŸ“œ
- **Backend:** - `AuditLogs` table captures Create/Update/Delete via SaveChanges Interceptor.
  - `AuditLogService` joins Users table & handles pagination.
  - `AdminAuditController` exposes logs to API.
- **Frontend:** - `AuditIndex.vue`: Enterprise-grade grid with sticky headers & badges.
  - **JSON Diff Viewer:** Side-by-side comparison of OldValues vs NewValues in modal.

## 4. ğŸš§ Pending Tasks (Roadmap)

### Phase 5: Content Management Core (Current Focus) ğŸ—ï¸
**Goal:** Create a flexible "Headless" content structure (Types & Entries).

1.  **Content Types (Schema Builder):**
    - [cite_start]**Backend:** Ensure `ContentType`, `ContentField` entities are robust[cite: 77, 105].
    - **Frontend:** UI to define new content types (e.g., "Blog Post", "Product") similar to Form Builder but for DB schema.
    
2.  **Content Entries (Data Entry):**
    - **Backend:** Dynamic CRUD for `ContentItem` (stored as JSON in SQL).
    - **Frontend:** Auto-generated forms based on Content Type schema for users to input data.

3.  **Content API (Headless):**
    - Public API for fetching content (e.g., `/api/content/posts`).

## 5. ğŸ¤– AI Persona Instructions (My Job)
1.  **Continuity:** Always check `AnosheCMS_Master_Context.txt` first.
2.  **Code Quality:** Prefer clean, readable code over clever one-liners. Use explicit DTOs.
3.  **Safety:** Prevent XSS/SQLi. Use `AsNoTracking` for read operations.
4.  **UI Consistency:** Match new pages (Content Types) with the style of `AuditIndex.vue` and `FormsIndex.vue`.